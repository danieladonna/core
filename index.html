<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@molecuel/core</title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.js" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@molecuel/core</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1> @molecuel/core</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<p><a href="https://travis-ci.org/molecuel/mlcl_core"><img src="https://travis-ci.org/molecuel/mlcl_core.svg?branch=master" alt="Build Status"></a>
				<a href="https://coveralls.io/github/molecuel/mlcl_core?branch=master"><img src="https://coveralls.io/repos/github/molecuel/mlcl_core/badge.svg?branch=master" alt="Coverage Status"></a></p>
				<h1 id="core-module-for-molecuel-framework">Core module for molecuel Framework</h1>
				<p>@molecuel/core is the core module for the molecuel application framework. It&#39;s initialization is based on the @molecuel/di Typescript dependency injection module.</p>
				<p>The version 2.x branch supports Subjects and streams based on rxjs.
					Streams can be used as DataStreams. For example for save handlers and much more. The streams in this case works like a queue of handlers for a dataset.
				Subjects can be used as EventEmitters (but should not be used too much).</p>
				<p>The core module is initialized as real Singleton based on the dependency injection module.</p>
				<h2 id="registering-data-functions">Registering data functions</h2>
				<p>Data functions are very important for a typical molecuel application. They are async and can be registered to be executed by various modules. For example a http or socket module can use a registered data function to return data from a datbase.
					The routes can be registered in the configuration.
				If the http module (for example) has a configured route which points to a @dataRead function it creates a app.get route from it and the return value of the registered function will be returned via http.</p>
				<p>Data Decorator provided by the core module:
					@dataRead - Tags a data function for reading data
					@dataCreate - Tags a data function for creating data
					@dataUpdate - Tags a data function for updating data
					@dataDelete - Tags a data function for deleting data
				@mapDataParams - Maps request parameters to the data function and specifies limits and type for parameters to enhance security.</p>
				<p>Example for a tagged class: </p>
				<pre><code class="lang-js"><span class="hljs-keyword">import</span> {di, injectable} <span class="hljs-keyword">from</span> <span class="hljs-string">'@molecuel/di'</span>;
<span class="hljs-keyword">import</span> {MlclCore, dataRead, dataCreate, dataUpdate, dataDelete, mapDataParams} <span class="hljs-keyword">from</span> <span class="hljs-string">'../dist'</span>;

@injectable
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyDataFunctionClass</span> </span>{
  @dataCreate()
  public myDataCreaCheck() {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  @dataUpdate()
  public myDataUpdateCheck() {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  @dataDelete()
  public <span class="hljs-keyword">async</span> myDataDeleteCheck() {
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }
  @mapDataParams([
    <span class="hljs-keyword">new</span> MlclDataParam(<span class="hljs-string">'id'</span>, <span class="hljs-string">'id'</span>, <span class="hljs-string">'integer'</span>, <span class="hljs-number">999</span>),
    <span class="hljs-keyword">new</span> MlclDataParam(<span class="hljs-string">'test'</span>, <span class="hljs-string">'name'</span>, <span class="hljs-string">'string'</span>, <span class="hljs-number">10</span>)
  ])
  @dataRead()
  public <span class="hljs-keyword">async</span> myDataReadCheck(id: number, <span class="hljs-attr">name</span>: string) {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">data</span>: <span class="hljs-string">'mydata'</span>
    };
  }
}
di.bootstrap(MlclCore);
</code></pre>
				<h3 id="init-system">Init system</h3>
				<p>The init system is based on the stream feature of molecuel core described below but can be combined with a method decorator on a injectable class to set different init methods.</p>
				<p>For example database initialization can have a higher priority ( lower init value ) or port listen directives can have higher priorities.</p>
				<p>The code example show how it works internally ( this can be used by every molecuel module and this is just example code). For example a http module can have two or more init functions. The first to initialize the routes and the second one to add the port listener after some other init priorities have been initialized.</p>
				<pre><code class="lang-js"><span class="hljs-keyword">import</span> {di, injectable} <span class="hljs-keyword">from</span> <span class="hljs-string">'@molecuel/di'</span>;
<span class="hljs-keyword">import</span> {Observable} <span class="hljs-keyword">from</span> <span class="hljs-string">'@reactivex/rxjs'</span>;
<span class="hljs-keyword">import</span> {MlclCore, init} <span class="hljs-keyword">from</span> <span class="hljs-string">'../dist'</span>;
di.bootstrap(MlclCore);
<span class="hljs-keyword">let</span> core = di.getInstance(<span class="hljs-string">'MlclCore'</span>);
<span class="hljs-keyword">let</span> obs1Success;
<span class="hljs-keyword">let</span> obs2Success;
<span class="hljs-comment">// this is normally part of a module and can be added via imports</span>
@injectable
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInitTestClass</span> </span>{
  <span class="hljs-comment">// sets the init priority to 20</span>
  @init(<span class="hljs-number">20</span>)
  public myinit(x) {
    <span class="hljs-keyword">return</span> Observable.create(<span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> {
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span>(obs2Success) {
          obs1Success = <span class="hljs-literal">true</span>;
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'huhu'</span>);
          y.next(x);
        } <span class="hljs-keyword">else</span> {
          y.error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wrong priority'</span>));
        }
        y.complete();
      }, <span class="hljs-number">100</span>);
    });
  }
}
<span class="hljs-comment">// this is normally part of a module and can be added via imports</span>
@injectable
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MyInitTestClass2</span> </span>{
  <span class="hljs-comment">// sets the init priority to 10</span>
  @init(<span class="hljs-number">50</span>)
  public myini2t(x) {
    <span class="hljs-keyword">return</span> Observable.create(<span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> {
      setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span>(!obs1Success) {
          obs2Success = <span class="hljs-literal">true</span>;
          <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'here'</span>);
          y.next(x);
        } <span class="hljs-keyword">else</span> {
          y.error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wrong priority'</span>));
        }
        y.complete();
      }, <span class="hljs-number">100</span>);
    });
  }
}
<span class="hljs-keyword">let</span> mlclInit = <span class="hljs-keyword">async</span> () =&gt; core.init();
mlclInit();
<span class="hljs-comment">// alternative init with promise</span>
<span class="hljs-comment">// this is the important part to run the complete init stream of the molecuel framework</span>
<span class="hljs-comment">/*core.init().then(function() {
  console.log('cherr');
});*/</span>
</code></pre>
				<h3 id="subject-example">Subject example</h3>
				<pre><code class="lang-js"><span class="hljs-keyword">import</span> {di} <span class="hljs-keyword">from</span> <span class="hljs-string">'mlcl_di'</span>;
<span class="hljs-keyword">import</span> {Subject, Observable} <span class="hljs-keyword">from</span> <span class="hljs-string">'@reactivex/rxjs'</span>;
<span class="hljs-keyword">import</span> {MlclCore, MlclMessage} <span class="hljs-keyword">from</span> <span class="hljs-string">'../dist'</span>;
di.bootstrap(MlclCore);
<span class="hljs-keyword">let</span> core = di.getInstance(<span class="hljs-string">'MlclCore'</span>)
<span class="hljs-keyword">let</span> initSubject = core.createSubject(<span class="hljs-string">'init'</span>);
initSubject.subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">msg: MlclMessage</span>) </span>{
    <span class="hljs-built_in">console</span>.log(msg);
});
<span class="hljs-keyword">let</span> msg = <span class="hljs-keyword">new</span> MlclMessage();
msg.topic= <span class="hljs-string">'test'</span>;
msg.message = <span class="hljs-string">'hello world'</span>;
initSubject.next(msg);
</code></pre>
				<h3 id="stream-example">Stream example</h3>
				<pre><code class="lang-js"><span class="hljs-keyword">import</span> {di} <span class="hljs-keyword">from</span> <span class="hljs-string">'mlcl_di'</span>;
<span class="hljs-keyword">import</span> {Subject, Observable} <span class="hljs-keyword">from</span> <span class="hljs-string">'@reactivex/rxjs'</span>;
<span class="hljs-keyword">import</span> {MlclCore, MlclStream} <span class="hljs-keyword">from</span> <span class="hljs-string">'../dist'</span>;
di.bootstrap(MlclCore);
<span class="hljs-keyword">let</span> core = di.getInstance(<span class="hljs-string">'MlclCore'</span>)
<span class="hljs-keyword">let</span> testStream = core.createStream(<span class="hljs-string">'teststream'</span>);
<span class="hljs-keyword">let</span> obs1 = <span class="hljs-function"><span class="hljs-params">x</span>=&gt;</span> Observable.create(<span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> {
  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span>(obs2Success) {
      obs1Success = <span class="hljs-literal">true</span>;
      y.next(x);
    } <span class="hljs-keyword">else</span> {
      y.error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wrong priority'</span>));
    }
    y.complete();
  }, <span class="hljs-number">100</span>);
});

<span class="hljs-keyword">let</span> obs2 = <span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> Observable.create(<span class="hljs-function"><span class="hljs-params">y</span> =&gt;</span> {
  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">if</span>(!obs1Success) {
      obs2Success = <span class="hljs-literal">true</span>;
      x.firstname = <span class="hljs-string">'Dominic2'</span>;
      y.next(x);
    } <span class="hljs-keyword">else</span> {
      y.error(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'Wrong priority'</span>));
    }
    y.complete();
  }, <span class="hljs-number">500</span>);
});
testStream.addObserverFactory(obs1, <span class="hljs-number">50</span>);
testStream.addObserverFactory(obs2, <span class="hljs-number">10</span>);

<span class="hljs-keyword">let</span> myobs = Observable.from([{<span class="hljs-attr">firstname</span>: <span class="hljs-string">'Dominic'</span>}]);
myobs = testStream.renderStream(myobs);
myobs.subscribe(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'got result'</span>);
}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
  should.not.exist(err);
}, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'execution of all observables completed'</span>);
});
</code></pre>
				<h2 id="config-handling">Config handling</h2>
				<p>The default config will be searched in the current working directory of the process in the config subfolder. If no NODE_ENV variable is set the development.json will be used.
				It&#39;s possible to override the configpath via environment variables.</p>
				<p>configpath is the path and will be combined with the NODE_ENV.
				configfilepath is the full path to a json configuration.</p>
				<pre><code class="lang-js"><span class="hljs-keyword">import</span> {di} <span class="hljs-keyword">from</span> <span class="hljs-string">'mlcl_di'</span>;
<span class="hljs-keyword">import</span> {MlclConfig} <span class="hljs-keyword">from</span> <span class="hljs-string">'../dist'</span>;

<span class="hljs-keyword">let</span> config = di.getInstance(<span class="hljs-string">'MlclConfig'</span>);
<span class="hljs-comment">// returns the whole configuration</span>
config.getConfig();
<span class="hljs-comment">// returns a dot notated path</span>
config.getConfig(<span class="hljs-string">'database.url'</span>);
</code></pre>
				<h2 id="api-documentation">API Documentation</h2>
				<p>The current API Documentation can be found on <a href="https://molecuel.github.io/mlcl_core/">https://molecuel.github.io/mlcl_core/</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclconfig.html" class="tsd-kind-icon">Mlcl<wbr>Config</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclconnection.html" class="tsd-kind-icon">Mlcl<wbr>Connection</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclcore.html" class="tsd-kind-icon">Mlcl<wbr>Core</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlcldatafactory.html" class="tsd-kind-icon">Mlcl<wbr>Data<wbr>Factory</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlcldataparam.html" class="tsd-kind-icon">Mlcl<wbr>Data<wbr>Param</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclmessage.html" class="tsd-kind-icon">Mlcl<wbr>Message</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclserver.html" class="tsd-kind-icon">Mlcl<wbr>Server</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/mlclstream.html" class="tsd-kind-icon">Mlcl<wbr>Stream</a>
					</li>
					<li class=" tsd-kind-class tsd-is-external">
						<a href="classes/observerfactoryelement.html" class="tsd-kind-icon">Observer<wbr>Factory<wbr>Element</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#datacreate" class="tsd-kind-icon">data<wbr>Create</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#datadelete" class="tsd-kind-icon">data<wbr>Delete</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#dataread" class="tsd-kind-icon">data<wbr>Read</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#dataupdate" class="tsd-kind-icon">data<wbr>Update</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#healthcheck" class="tsd-kind-icon">health<wbr>Check</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#init" class="tsd-kind-icon">init</a>
					</li>
					<li class=" tsd-kind-function tsd-is-external">
						<a href="globals.html#mapdataparams" class="tsd-kind-icon">map<wbr>Data<wbr>Params</a>
					</li>
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-module"><span class="tsd-kind-icon">Module</span></li>
				<li class="tsd-kind-object-literal"><span class="tsd-kind-icon">Object literal</span></li>
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-function tsd-has-type-parameter"><span class="tsd-kind-icon">Function with type parameter</span></li>
				<li class="tsd-kind-index-signature"><span class="tsd-kind-icon">Index signature</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
				<li class="tsd-kind-enum-member"><span class="tsd-kind-icon">Enumeration member</span></li>
				<li class="tsd-kind-property tsd-parent-kind-enum"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-enum"><span class="tsd-kind-icon">Method</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-interface"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-interface"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
				<li class="tsd-kind-class tsd-has-type-parameter"><span class="tsd-kind-icon">Class with type parameter</span></li>
				<li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class"><span class="tsd-kind-icon">Accessor</span></li>
				<li class="tsd-kind-index-signature tsd-parent-kind-class"><span class="tsd-kind-icon">Index signature</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li>
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li>
				<li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li>
				<li class="tsd-kind-accessor tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private accessor</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-property tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static property</span></li>
				<li class="tsd-kind-call-signature tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="http://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="assets/js/search.js"><' + '/script>');</script>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-89800241-1', '');
        ga('send', 'pageview');
    </script>
</body>
</html>