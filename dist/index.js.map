{"version":3,"sources":["index.ts"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;;;;;;;;AACb,4BAA0B;AAC1B,0CAAoD;AACpD,qCAA8C;AAG9C,IAAa,QAAQ,GAArB;IADA;QAEY,YAAO,GAA4B,IAAI,GAAG,EAAE,CAAC;QAC7C,aAAQ,GAA8B,IAAI,GAAG,EAAE,CAAC;IAqC5D,CAAC;IA3BQ,aAAa,CAAC,KAAa;QAChC,EAAE,CAAA,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QAClC,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,IAAI,OAAO,GAAG,IAAI,cAAO,EAAE,CAAC;YAC5B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;YAClC,MAAM,CAAC,OAAO,CAAC;QACjB,CAAC;IACH,CAAC;IAWM,YAAY,CAAC,IAAY;QAC9B,IAAI,aAAa,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QAC3C,EAAE,CAAA,CAAC,CAAC,aAAa,CAAC,CAAC,CAAC;YAClB,aAAa,GAAG,IAAI,UAAU,CAAC,IAAI,CAAC,CAAC;YACrC,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,EAAE,aAAa,CAAC,CAAC;QACxC,CAAC;QACD,MAAM,CAAC,aAAa,CAAC;IACvB,CAAC;CACF,CAAA;AAvCY,QAAQ;IADpB,mBAAS;;GACG,QAAQ,CAuCpB;AAvCY,4BAAQ;AA8CrB,IAAa,UAAU,GAAvB;IAaE,YAAY,IAAY;QATjB,sBAAiB,GAAkC,IAAI,KAAK,EAAE,CAAC;QAUpE,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;IACnB,CAAC;IAUM,YAAY,CAAC,eAAgC;QAClD,IAAI,WAAW,GAAkC,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,UAAS,CAAyB,EAAE,CAAyB;YACxI,MAAM,CAAC,CAAC,CAAC,QAAQ,GAAG,CAAC,CAAC,QAAQ,CAAC;QACjC,CAAC,CAAC,CAAC;QACH,GAAG,CAAA,CAAC,IAAI,MAAM,IAAI,WAAW,CAAC,CAAC,CAAC;YAC9B,eAAe,CAAC,OAAO,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;QAChD,CAAC;QACD,MAAM,CAAC,eAAe,CAAC;IACzB,CAAC;IAWM,kBAAkB,CAAC,eAA+C,EAAE,WAAmB,EAAE;QAC9F,IAAI,cAAc,GAAG,IAAI,sBAAsB,CAAC,QAAQ,EAAE,eAAe,CAAC,CAAC;QAC3E,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC9C,CAAC;CACF,CAAA;AAhDY,UAAU;IADtB,oBAAU;;GACE,UAAU,CAgDtB;AAhDY,gCAAU;AAyDvB,IAAa,sBAAsB,GAAnC;IAWE,YAAmB,WAAmB,EAAE,EAAE,aAA6C;QACrF,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;QACzB,IAAI,CAAC,aAAa,GAAG,aAAa,CAAC;IACrC,CAAC;CACF,CAAA;AAfY,sBAAsB;IADlC,oBAAU;;GACE,sBAAsB,CAelC;AAfY,wDAAsB;AAyBnC,IAAa,WAAW,GAAxB;CAIC,CAAA;AAJY,WAAW;IADvB,oBAAU;;GACE,WAAW,CAIvB;AAJY,kCAAW","file":"index.js","sourcesContent":["'use strict';\nimport 'reflect-metadata';\nimport {Observable, Subject} from '@reactivex/rxjs';\nimport {singleton, injectable} from 'mlcl_di';\n\n@singleton\nexport class MlclCore {\n  protected streams: Map<string, MlclStream> = new Map();\n  protected subjects: Map<string, Subject<any>> = new Map();\n\n  /**\n   * Creates a new subject which enables EventEmitter like functionality\n   * \n   * @param {string} topic\n   * @returns {Subject<any>}\n   * \n   * @memberOf MlclCore\n   */\n  public createSubject(topic: string): Subject<any> {\n    if(this.subjects.get(topic)) {\n      return this.subjects.get(topic);\n    } else {\n      let subject = new Subject();\n      this.subjects.set(topic, subject);\n      return subject;\n    }\n  }\n\n\n  /**\n   * Creates or returns a Stream\n   * \n   * @param {string} name\n   * @returns {MlclStream}\n   * \n   * @memberOf MlclCore\n   */\n  public createStream(name: string): MlclStream {\n    let currentStream = this.streams.get(name);\n    if(!currentStream) {\n      currentStream = new MlclStream(name);\n      this.streams.set(name, currentStream);\n    }\n    return currentStream;\n  }\n}\n\n/**\n * @export\n * @class MlclStream\n */\n@injectable\nexport class MlclStream {\n  // name of the current stream\n  public name: string;\n  // observer factory methods registered\n  public observerFactories: Array<ObserverFactoryElement> = new Array();\n\n  /**\n   * Creates an instance of MlclStream.\n   * \n   * @param {string} name\n   * \n   * @memberOf MlclStream\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Renders the stream and add flatMaps to the input observable\n   * \n   * @param {Observable} inputObservable\n   * @returns\n   * \n   * @memberOf MlclStream\n   */\n  public renderStream(inputObservable: Observable<any>) {\n    let observables: Array<ObserverFactoryElement> = this.observerFactories.sort(function(a: ObserverFactoryElement, b: ObserverFactoryElement) {\n      return a.priority - b.priority;\n    });\n    for(let observ of observables) {\n      inputObservable.flatMap(observ.factoryMethod);\n    }\n    return inputObservable;\n  }\n\n  /**\n   * Add observable to the stream\n   * \n   * @param {string} stream\n   * @param {Observable} observable\n   * @param {int} [priority=50]\n   * \n   * @memberOf MlclStream\n   */\n  public addObserverFactory(observerFactory: (data: any) => Observable<any>, priority: number = 50) {\n    let factoryElement = new ObserverFactoryElement(priority, observerFactory);\n    this.observerFactories.push(factoryElement);\n  }\n}\n\n/**\n * A ObserverFactory element which is used for queuing observers for a specific queue / observable\n * \n * @export\n * @class ObserverFactoryElement\n */\n@injectable\nexport class ObserverFactoryElement {\n  public priority: number;\n  public factoryMethod: (data: any) => Observable<any>;\n  /**\n   * Creates an instance of ObserverFactoryElement.\n   * \n   * @param {number} [priority=50]\n   * @param null [factoryMethod]\n   * \n   * @memberOf ObserverFactoryElement\n   */\n  public constructor(priority: number = 50, factoryMethod: (data: any) => Observable<any>) {\n    this.priority = priority;\n    this.factoryMethod = factoryMethod;\n  }\n}\n\n\n/**\n * Message class for system internal messaging\n * \n * @export\n * @class MlclMessage\n */\n@injectable\nexport class MlclMessage {\n  public topic: string;\n  public message: any;\n  public source: string;\n}"]}